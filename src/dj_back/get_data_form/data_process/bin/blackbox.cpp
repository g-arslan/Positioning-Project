#include <algorithm>
#include <fstream>
#include <iostream>
#include <string>
#include <unistd.h>

const std::string PATH_TO_FILE_KEY = "RoverFile";

int main(int argc, char **argv) {
    if (argc < 2) {
        std::cerr << "No config file provided\n";
        return 1;
    }

    std::string config_path = argv[1];

    std::ifstream iniFile(config_path);

    if (!iniFile.good()) {
        std::cerr << "There is no \"" + config_path + "\" found\n";
        return 1;
    }

    std::string line, path;
    bool found = false;

    while (getline(iniFile, line)) {
        int equal = -1;
        for (size_t i = 0; i < line.size(); ++i) {
            if (line[i] == '=') {
                equal = i;
                break;
            }
        }

        if (equal == -1) continue;

        std::string key = line.substr(0, equal), value = line.substr(equal + 1, (int)line.size() - equal - 1);

        while (key.back() == ' ') key.pop_back();
        reverse(value.begin(), value.end());
        while (value.back() == ' ') value.pop_back();
        reverse(value.begin(), value.end());

        if (key == PATH_TO_FILE_KEY) {
            found = true;
            path = value;
        }
    }

    if (!found) {
        std::cerr << "There is no \"" + PATH_TO_FILE_KEY + "\" key in \"" + config_path + "\"\n";
        return 1;
    }

    std::ifstream dataFile(path);

    if (!dataFile.good()) {
        std::cerr << "There is no data file \"" + path + "\" found\n";
        return 1;
    }

    // Pretend like something happening
    srand(time(NULL));
    int sec = rand() % 7 + 1;
    sleep(sec);

    std::ofstream resSolFile("result.gga");
    resSolFile << "$GPZDA,235942.00,07,03,2018,00,00*62\n"
                    "$GPGGA,235942.00,5445.5068028,N,00628.3679718,W,2,16,0.67,73.5394,M,0.0,M,0.0,*59\n"
                    "$GPGGA,235943.00,5445.5068179,N,00628.3678600,W,2,16,0.67,73.5865,M,0.0,M,0.0,*51\n"
                    "$GPGGA,235944.00,5445.5068410,N,00628.3678172,W,2,16,0.67,73.6576,M,0.0,M,0.0,*52\n"
                    "$GPGGA,235945.00,5445.5068791,N,00628.3678065,W,2,16,0.67,73.7185,M,0.0,M,0.0,*57\n"
                    "$GPGGA,235946.00,5445.5069154,N,00628.3677446,W,2,16,0.67,73.7760,M,0.0,M,0.0,*5D\n"
                    "$GPGGA,235947.00,5445.5069454,N,00628.3676894,W,2,16,0.67,73.8229,M,0.0,M,0.0,*5C\n"
                    "$GPGGA,235948.00,5445.5069747,N,00628.3676490,W,2,16,0.67,73.8368,M,0.0,M,0.0,*5E\n"
                    "$GPGGA,235949.00,5445.5069745,N,00628.3676444,W,2,16,0.67,73.8634,M,0.0,M,0.0,*58\n"
                    "$GPGGA,235950.00,5445.5069738,N,00628.3676511,W,2,16,0.67,73.8568,M,0.0,M,0.0,*51\n"
                    "$GPGGA,235951.00,5445.5069715,N,00628.3676567,W,2,16,0.67,73.8653,M,0.0,M,0.0,*55\n"
                    "$GPGGA,235952.00,5445.5069978,N,00628.3676859,W,2,16,0.67,73.9040,M,0.0,M,0.0,*56\n"
                    "$GPGGA,235953.00,5445.5070516,N,00628.3677186,W,2,16,0.67,73.9715,M,0.0,M,0.0,*56\n"
                    "$GPGGA,235954.00,5445.5071209,N,00628.3677338,W,2,16,0.67,74.0538,M,0.0,M,0.0,*5D\n"
                    "$GPGGA,235955.00,5445.5071768,N,00628.3677532,W,2,16,0.67,74.1501,M,0.0,M,0.0,*59\n"
                    "$GPGGA,235956.00,5445.5072322,N,00628.3677484,W,2,16,0.67,74.2611,M,0.0,M,0.0,*5E\n"
                    "$GPGGA,235957.00,5445.5072669,N,00628.3677627,W,2,16,0.67,74.3398,M,0.0,M,0.0,*5B\n"
                    "$GPGGA,001015.00,5445.5068790,N,00628.3682117,W,5,16,0.67,76.2366,M,0.0,M,0.0,*56\n"
                    "$GPGGA,001016.00,5445.5068784,N,00628.3682111,W,5,16,0.67,76.2384,M,0.0,M,0.0,*5A\n"
                    "$GPGGA,001017.00,5445.5068779,N,00628.3682109,W,5,16,0.67,76.2399,M,0.0,M,0.0,*5C\n"
                    "$GPGGA,001018.00,5445.5068773,N,00628.3682097,W,5,16,0.67,76.2415,M,0.0,M,0.0,*5C\n"
                    "$GPGGA,001019.00,5445.5068769,N,00628.3682095,W,5,16,0.67,76.2440,M,0.0,M,0.0,*54\n"
                    "$GPGGA,001020.00,5445.5068766,N,00628.3682092,W,5,16,0.67,76.2456,M,0.0,M,0.0,*51\n"
                    "$GPGGA,001021.00,5445.5068765,N,00628.3682088,W,5,16,0.67,76.2478,M,0.0,M,0.0,*54\n"
                    "$GPGGA,001022.00,5445.5068760,N,00628.3682089,W,5,16,0.67,76.2489,M,0.0,M,0.0,*5D\n"
                    "$GPGGA,001023.00,5445.5068758,N,00628.3682089,W,5,16,0.67,76.2494,M,0.0,M,0.0,*5B\n"
                    "$GPGGA,001024.00,5445.5068757,N,00628.3682097,W,5,16,0.67,76.2496,M,0.0,M,0.0,*5E\n"
                    "$GPGGA,001025.00,5445.5068761,N,00628.3682104,W,5,16,0.67,76.2488,M,0.0,M,0.0,*5E\n"
                    "$GPGGA,001026.00,5445.5068767,N,00628.3682106,W,5,16,0.67,76.2480,M,0.0,M,0.0,*51\n"
                    "$GPGGA,001027.00,5445.5068773,N,00628.3682107,W,5,16,0.67,76.2479,M,0.0,M,0.0,*52\n"
                    "$GPGGA,001028.00,5445.5068779,N,00628.3682110,W,5,16,0.67,76.2481,M,0.0,M,0.0,*56\n"
                    "$GPGGA,001029.00,5445.5068783,N,00628.3682115,W,5,16,0.67,76.2484,M,0.0,M,0.0,*52\n"
                    "$GPGGA,001030.00,5445.5068786,N,00628.3682113,W,5,16,0.67,76.2479,M,0.0,M,0.0,*5B\n"
                    "$GPGGA,001031.00,5445.5068787,N,00628.3682111,W,5,16,0.67,76.2461,M,0.0,M,0.0,*50\n"
                    "$GPGGA,001032.00,5445.5068787,N,00628.3682109,W,5,16,0.67,76.2445,M,0.0,M,0.0,*5C\n"
                    "$GPGGA,001033.00,5445.5068790,N,00628.3682111,W,5,16,0.67,76.2434,M,0.0,M,0.0,*54\n"
                    "$GPGGA,001034.00,5445.5068790,N,00628.3682116,W,5,16,0.67,76.2425,M,0.0,M,0.0,*54\n"
                    "$GPGGA,001035.00,5445.5068790,N,00628.3682117,W,5,16,0.67,76.2420,M,0.0,M,0.0,*51\n";

    return 0;
}
